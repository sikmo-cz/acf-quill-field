var acfQuillFieldPlugin;(()=>{"use strict";var t={observer:null,unsavedChanges:!1,init:function(){const t=this;t.initQuillEditors(),t.observe(),t.setupUnsavedChangesWarning(),t.setupSaveListener()},setupUnsavedChangesWarning:function(){const t=this;window.addEventListener("beforeunload",(function(e){if(t.unsavedChanges){const t="The changes you made will be lost if you navigate away from this page.";return e.returnValue=t,t}}))},observe:function(){const t=this;t.observer=new MutationObserver((e=>{for(const i of e)i.addedNodes.length>0&&i.addedNodes.forEach((e=>{if(1===e.nodeType){const i=e.querySelectorAll?.(".acf-quill-editor");i.length>0&&t.initQuillEditors()}}))})),t.observer.observe(document.body,{childList:!0,subtree:!0})},initQuillEditors:function(){const t=this;document.querySelectorAll(".acf-quill-editor").forEach((e=>{if("true"===e.dataset.quillInit)return;const i=e.nextElementSibling;if(!i)return;const l=i.parentElement;let n=t.buildToolbarFromConfig();const o=Quill.import("blots/embed"),s=Quill.import("delta");Quill.register(class extends o{static blotName="break";static tagName="br";static create(){return super.create()}static formats(){return!0}static value(){return!0}optimize(){super.optimize()}length(){return 1}},!0);let a={modules:{toolbar:{container:n,handlers:{link:function(){window.link&&window.link.toolbarHandler&&window.link.toolbarHandler.call(this)}}},clipboard:{matchVisual:!1},wpImageToolbar:{onEdit(t,e,i,l){}}},theme:"snow",placeholder:acf_quill_field.l10n.placeholder};const r=new Quill(e,a);e.__quill=r;const c=e.querySelector(".ql-editor");c&&c.addEventListener("keydown",(function(t){if("Enter"===t.key&&t.shiftKey){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const e=r.getSelection();if(e){const t=r.getLength(),i=e.index>=t-1,[l,n]=r.getLine(e.index),o=""===(l?r.getText(l.offset(),l.length()):"").trim();if(i&&o)return!1;r.insertEmbed(e.index,"break",!0,"user"),setTimeout((()=>{r.setSelection(e.index+1,0,"user")}),0)}return!1}}),!0);const d=i.value;if(d.trim()){let t=d.replace(/<br\s*\/?>/gi,"___LINEBREAK___");const e=r.clipboard.convert({html:t});r.setContents(e,"silent"),setTimeout((()=>{const t=r.getContents(),e=[];for(const i of t.ops)if(i.insert&&"string"==typeof i.insert&&i.insert.includes("___LINEBREAK___")){const t=i.insert.split("___LINEBREAK___");for(let l=0;l<t.length;l++)t[l]&&e.push({insert:t[l],attributes:i.attributes}),l<t.length-1&&e.push({insert:{break:!0}})}else e.push(i);if(e.length>0){const t=new s(e);r.setContents(t,"silent")}}),100)}const u=r.emitter.listeners["text-change"];r.emitter.listeners["text-change"]=function(t,e,i){if("user"===i){const l=t.ops.map((t=>(t.insert&&"string"==typeof t.insert&&(t.insert=t.insert.replace(/\u00A0/g," ")),t))),n=new s(l);u(n,e,i)}else u(t,e,i)},r.on("text-change",((l,n,o)=>{if("user"!==o)return void t.updateWordCount(e,r);let s=r.getSemanticHTML();s=s.replace(/((?:&nbsp;)*)&nbsp;/g,"$1 "),s=s.replace(/&quot;/g,'"'),s=s.replace(/<br>\s*<br>/g,"<br>"),s=s.replace(/<br>\s*<\/p>/g,"</p>"),s=s.replace(/<br>\s*<\/h([1-6])>/g,"</h$1>"),s=s.replace(/<br>\s*<\/li>/g,"</li>"),s=s.replace(/<p><\/p>$/,""),s=s.replace(/<p><br><\/p>$/,""),i.value!==s?(i.value=s,t.updateWordCount(e,r),t.unsavedChanges=!0,t.triggerChange(i),window.wp&&window.wp.data&&window.wp.data.select&&window.wp.data.select("core/editor")):t.updateWordCount(e,r)})),t.createEditorInfoElements(e,l),t.updateWordCount(e,r),r.on("selection-change",(function(i,l,n){t.updatePathDisplay(e,r,i)})),setTimeout((()=>{t.prepareTooltips(l)}),50),e.dataset.quillInit="true"})),window.acfQuillEditorsLoaded=!0,document.dispatchEvent(new Event("acf-quill-editors-loaded"))},triggerChange:function(t){if(!(window.wp&&window.wp.data&&window.wp.data.select&&window.wp.data.select("core/editor"))){const e=new Event("change",{bubbles:!0});t.dispatchEvent(e);const i=new Event("input",{bubbles:!0});t.dispatchEvent(i)}},notifyGutenberg:function(){if(this.unsavedChanges&&window.wp&&window.wp.data&&window.wp.data.dispatch)try{window.wp.data.dispatch("core/editor").editPost({modified:!0})}catch(t){console.warn("Error notifying Gutenberg of changes",t)}},createEditorInfoElements:function(t,e){const i=acf_quill_field.l10n,l=document.createElement("div");l.className="quill-editor-info";const n=document.createElement("div");n.className="quill-word-count",n.textContent=`${i.words.word_count}: 0`;const o=document.createElement("div");o.className="quill-path-display",l.appendChild(n),l.appendChild(o),t.wordCountEl=n,t.pathDisplayEl=o,t.closest(".acf-quill-field");const s=t.closest(".acf-input");s?s.appendChild(l):t.parentNode.insertBefore(l,t.nextSibling)},updateWordCount:function(t,e){if(!t.wordCountEl)return;const i=acf_quill_field.l10n,l=e.getText(),n=l.trim()?l.trim().split(/\s+/).length:0;t.wordCountEl.textContent=`${i.words.word_count}: ${n}`},updatePathDisplay:function(t,e,i){if(!t.pathDisplayEl||!i)return;let l="";const n=acf_quill_field.l10n;try{const[t,n]=e.getLeaf(i.index);if(!t)return;const o=[];let s=t.domNode;for(s.nodeType===Node.TEXT_NODE&&(s=s.parentNode);s;){if(s.nodeType===Node.ELEMENT_NODE&&(!s.classList||!s.classList.contains("ql-editor")&&!s.classList.contains("ql-container"))){let t=s.tagName.toLowerCase(),e=t;if("ol"===t){const t=s.querySelectorAll("li")[0];t&&"bullet"===t.getAttribute("data-list")&&(e="ul")}"li"==t&&""!=s.classList.value&&s.classList.value.includes("ql-indent-")&&(e+=` > ${"bullet"==s.getAttribute("data-list")?"ul":"ol"} > li`);const i=Array.from(s.classList||[]).filter((t=>!t.startsWith("ql-")&&"ql-editor"!==t&&"ql-container"!==t));i.length>0&&!e.includes(".")&&(e+=`.${i.join(".")}`),o.unshift(e)}if(s=s.parentNode,s&&s.classList&&(s.classList.contains("ql-editor")||s.classList.contains("ql-container")))break}l=o.join(" > ")}catch(t){console.error("Path display error:",t),l=n.path.not_available}t.pathDisplayEl.textContent=`${n.path.path}: ${l||n.path.not_available}`},prepareTooltips:function(t){const e=this,i=acf_quill_field.l10n.tooltip;[[".ql-bold",i.bold],[".ql-italic",i.italic],[".ql-underline",i.underline],[".ql-strike",i.strike],[".ql-link",i.link],[".ql-color",i.color],[".ql-background",i.background],['.ql-align[value=""]',i.left],['.ql-align[value="justify"]',i.justify],['.ql-align[value="center"]',i.center],['.ql-align[value="right"]',i.right],['.ql-list[value="bullet"]',i.ul],['.ql-list[value="ordered"]',i.ol],['.ql-indent[value="+1"]',i.indent_plus],['.ql-indent[value="-1"]',i.indent_minus],['.ql-script[value="super"]',i.script_sup],['.ql-script[value="sub"]',i.script_sub],[".ql-blockquote",i.blockquote],[".ql-code",i.code],[".ql-code-block",i.code_block],[".ql-clean",i.clean],[".ql-wp-media",i.wp_media]].forEach((i=>{e.acfQuillFieldAddTooltip(t.querySelector(i[0]),i[1])}))},acfQuillFieldAddTooltip:function(t,e){t&&(t.setAttribute("aria-label",e),t.setAttribute("data-balloon-pos","up"))},buildToolbarFromConfig:function(){const t=[[{header:[1,2,3,4,5,6,!1]}],["bold","italic","underline","strike","link"],[{color:[]},{background:[]}],[{align:""},{align:"center"},{align:"right"},{align:"justify"}],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{script:"super"},{script:"sub"}],["blockquote","code"],["code-block"],["clean"],[{"wp-media":!0}]];if(!window.acf_quill_field||!window.acf_quill_field.toolbar_config)return t;if(!window.acf_quill_field||!window.acf_quill_field.load_toolbar_config)return t;try{const t=window.acf_quill_field.toolbar_config,e=window.acf_quill_field.format_options||{};return t.map((t=>t.map((t=>{if("string"==typeof t){if("wp-media"===t)return{"wp-media":!0};if(e[t]){const i={};return i[t]=e[t],i}return t}return t}))))}catch(e){return console.error("Error building toolbar:",e),t}},resetUnsavedChanges:function(){this.unsavedChanges=!1},setupSaveListener:function(){const t=this;if(document.addEventListener("submit",(function(e){e.target&&("post"===e.target.id||e.target.classList.contains("wp-admin")||e.target.action&&e.target.action.includes("post.php"))&&t.resetUnsavedChanges()})),document.addEventListener("click",(function(e){e.target&&("publish"===e.target.id||"save-post"===e.target.id||"save"===e.target.name||"publish"===e.target.name||e.target.classList.contains("button-primary"))&&setTimeout((()=>{t.resetUnsavedChanges()}),500)})),!window.wp||!window.wp.data||!window.wp.data.subscribe)return;setTimeout((()=>{t.resetUnsavedChanges()}),1e3);const e=function(){let e=!1,i=!1;window.wp.data.subscribe((function(){if(window.wp.data.select("core/editor"))try{const l=window.wp.data.select("core/editor").isSavingPost(),n=window.wp.data.select("core/editor").isAutosavingPost();(e&&!l||i&&!n)&&setTimeout((()=>{t.resetUnsavedChanges()}),1e3),e=l,i=n}catch(t){console.warn("Error checking save status:",t)}}))};if(window.wp.data.select("core/editor"))e();else{const t=setInterval((function(){window.wp.data.select("core/editor")&&(clearInterval(t),e())}),200);setTimeout((function(){clearInterval(t)}),5e3)}}},e={wpmediaIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" color="#000000" fill="none"> <path class="ql-stroke" d="M2.5 16.502L7.46967 11.5323C7.80923 11.1927 8.26978 11.002 8.75 11.002C9.23022 11.002 9.69077 11.1927 10.0303 11.5323L14 15.502M15.5 17.002L14 15.502M21.5 16.502L18.5303 13.5323C18.1908 13.1927 17.7302 13.002 17.25 13.002C16.7698 13.002 16.3092 13.1927 15.9697 13.5323L14 15.502" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path class="ql-stroke" d="M15.5 8.00195C15.7761 8.00195 16 7.7781 16 7.50195C16 7.22581 15.7761 7.00195 15.5 7.00195M15.5 8.00195C15.2239 8.00195 15 7.7781 15 7.50195C15 7.22581 15.2239 7.00195 15.5 7.00195M15.5 8.00195V7.00195" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path class="ql-stroke" d="M21.5 19.502V4.50195C21.5 3.39738 20.6046 2.50195 19.5 2.50195H4.5C3.39543 2.50195 2.5 3.39738 2.5 4.50195V19.502C2.5 20.6065 3.39543 21.502 4.5 21.502H19.5C20.6046 21.502 21.5 20.6065 21.5 19.502Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>',init:function(){const t=Quill.import("modules/toolbar"),e=Quill.import("formats/image");Quill.import("ui/icons")["wp-media"]=this.wpmediaIcon,Quill.register(class extends e{static blotName="wpimage";static tagName="img";static create(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=super.create(t.src||t);return Object.entries(t).forEach((t=>{let[i,l]=t;null!=l&&e.setAttribute(i,l)})),e}static value(t){return Array.from(t.attributes).reduce(((t,e)=>(t[e.name]=e.value,t)),{})}},!0),t.DEFAULTS.handlers["wp-media"]=this.openMedia},openMedia:function(){const t=this.quill,e=t.getSelection(!0),i=wp.media({frame:"post",state:"insert",library:{type:"image"},multiple:!1});i.$el.addClass("acf-quill-field-add-media"),i.on("insert",(()=>{const l=i.state(),n=l.get("selection").first();if(!n)return;const o=n.toJSON();let s=l.display(n).toJSON(),a="file"==s.link&&o.url;s=wp.media.string.props(s,n),s.linkUrl=!1===a?s.linkUrl:a;const r=o?.sizes?.[s.size]||o,c={src:r.url,width:r.width,height:r.height,alt:o.alt,title:o.title,class:`align${s.align||"none"} size-${s.size} wp-image-${o.id}`};t.insertEmbed(e.index,"wpimage",c,"user"),t.insertText(e.index+1,"\n","user"),s.linkUrl&&"none"!==s.linkUrl&&t.formatText(e.index,1,{link:s.linkUrl},"user"),t.setSelection(e.index+2,0)})),i.open()}},i={dataBalloon:'data-balloon-pos="up"',iconList:{AlignNone:'<svg viewBox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"></line><line class="ql-stroke" x1="15" x2="3" y1="14" y2="14"></line><line class="ql-stroke" x1="15" x2="3" y1="4" y2="4"></line></svg>',AlignLeft:'<svg viewBox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="9" y2="9"></line><line class="ql-stroke" x1="3" x2="13" y1="14" y2="14"></line><line class="ql-stroke" x1="3" x2="9" y1="4" y2="4"></line></svg>',AlignCenter:'<svg viewBox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"></line><line class="ql-stroke" x1="14" x2="4" y1="14" y2="14"></line><line class="ql-stroke" x1="12" x2="6" y1="4" y2="4"></line></svg>',AlignRight:'<svg viewBox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"></line><line class="ql-stroke" x1="15" x2="5" y1="14" y2="14"></line><line class="ql-stroke" x1="15" x2="9" y1="4" y2="4"></line></svg>',Edit:'<svg viewBox="0 0 24 24" width="18" height="18" color="#000000" fill="none"> <path class="ql-stroke" d="M3.5 17.1213V20.5H6.87868C7.2765 20.5 7.65804 20.342 7.93934 20.0607L20.06 7.93934C20.6458 7.35355 20.6458 6.40381 20.06 5.81802L18.1813 3.93934C17.5955 3.35355 16.6458 3.35355 16.06 3.93934L3.93934 16.0607C3.65804 16.342 3.5 16.7235 3.5 17.1213Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" /> <path class="ql-stroke" d="M13.5002 6.49902L17.5002 10.499" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" /> </svg>',Remove:'<svg viewBox="0 0 24 24" width="18" height="18" color="#000000" fill="none"> <path class="ql-stroke" d="M19.5 5.5L18.6139 20.121C18.5499 21.1766 17.6751 22 16.6175 22H7.38246C6.32488 22 5.4501 21.1766 5.38612 20.121L4.5 5.5" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path class="ql-stroke" d="M3 5.5H8M21 5.5H16M16 5.5L14.7597 2.60608C14.6022 2.2384 14.2406 2 13.8406 2H10.1594C9.75937 2 9.39783 2.2384 9.24025 2.60608L8 5.5M16 5.5H8" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path class="ql-stroke" d="M9.5 16.5L9.5 10.5" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path class="ql-stroke" d="M14.5 16.5L14.5 10.5" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>'},init:function(){const t=this,e=Quill.import("ui/tooltip");Quill.register("modules/wpImageToolbar",class extends e{constructor(e){super(e,(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).bounds||e.root.parentNode),this.root.classList.add("ql-wpmedia-toolbar"),this.root.innerHTML=`\n\t\t\t\t\t<span class="ql-formats">\n\t\t\t\t\t\t<button class="ql-align" aria-label="${acf_quill_field.l10n.tooltip.none}" ${t.dataBalloon} data-align="" title="None">\n\t\t\t\t\t\t\t${t.iconList.AlignNone}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button class="ql-align" aria-label="${acf_quill_field.l10n.tooltip.left}" ${t.dataBalloon} data-align="left" title="Left">\n\t\t\t\t\t\t\t${t.iconList.AlignLeft}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button class="ql-align" aria-label="${acf_quill_field.l10n.tooltip.center}" ${t.dataBalloon} data-align="center" title="Center">\n\t\t\t\t\t\t\t${t.iconList.AlignCenter}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button class="ql-align" aria-label="${acf_quill_field.l10n.tooltip.right}" ${t.dataBalloon} data-align="right" title="Right">\n\t\t\t\t\t\t\t${t.iconList.AlignRight}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</span>\n\t\t\t\t\t<button class="edit" aria-label="${acf_quill_field.l10n.tooltip.edit}" ${t.dataBalloon} title="Edit">\n\t\t\t\t\t\t${t.iconList.Edit}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button class="remove" aria-label="${acf_quill_field.l10n.tooltip.delete}" ${t.dataBalloon} title="Remove">\n\t\t\t\t\t\t${t.iconList.Remove}\n\t\t\t\t\t</button>\n\t\t\t\t`,this.alignBtns=Array.from(this.root.querySelectorAll(".ql-align"));const i=this.root.querySelector(".edit"),l=this.root.querySelector(".remove");e.root.addEventListener("click",(i=>{const l=i.target.closest('img[class*="wp-image-"]');l?(this.img=l,this.blot=Quill.find(l),this.index=this.blot.offset(e.scroll),this._updateActiveAlign(),this._position(),t.hideLinkToolTip(),this.show(),requestAnimationFrame((()=>this._position()))):(this.hide(),t.hideMediaFocus(document.querySelector("img.in-focus")))})),this.alignBtns.forEach((t=>{t.addEventListener("click",(i=>{i.preventDefault();const l=t.dataset.align||!1;["alignnone","alignleft","aligncenter","alignright"].forEach((t=>this.img.classList.remove(t))),this.img.classList.add(l?`align${l}`:"alignnone"),e.formatLine(this.index,1,{align:l||!1},"user"),this._updateActiveAlign()}))})),l.addEventListener("click",(t=>{t.preventDefault(),e.deleteText(this.index,2,"user"),this.hide()})),i.addEventListener("click",(i=>{i.preventDefault(),t.openImageDetails(this.img,this.blot,this.index,e),this.hide()})),document.addEventListener("click",(i=>{"none"!==this.root.style.display&&!e.root.contains(i.target)&&i.target&&(this.hide(),t.hideMediaFocus(document.querySelector("img.in-focus")))}),!0);const n=()=>this.img&&"none"!==this.root.style.display&&this._position();e.root.parentNode.addEventListener("scroll",n,{passive:!0}),window.addEventListener("scroll",n,{passive:!0}),window.addEventListener("resize",n),e.on("text-change",n)}_updateActiveAlign(){const t=(/align(left|center|right)/.exec(this.img.className)||[])[1]||"";this.alignBtns.forEach((e=>e.classList.toggle("ql-active",e.dataset.align===t)))}_position(){const t=this.img.getBoundingClientRect(),e=this.quill.root.parentNode.getBoundingClientRect();this.root.style.left=t.left-e.left+t.width/2-this.root.offsetWidth/2+"px",this.root.style.top=t.top-e.top-this.root.offsetHeight-10+"px",this.quill.root.parentNode.querySelector(".ql-wpmedia-toolbar").classList.contains("ql-hidden")||this.img.classList.add("in-focus")}})},hideLinkToolTip:function(){document.querySelectorAll(".ql-tooltip.ql-flip:not( .ql-hidden )").forEach((t=>{t.classList.add("ql-hidden")}))},hideMediaFocus:function(t){if(!t)return!1;t.classList.remove("in-focus")},hideMediaTooltip:function(){document.querySelectorAll(".ql-tooltip.ql-flip:not( .ql-hidden )").forEach((t=>{t.classList.add("ql-hidden")}))},getWpImageId:function(t){const e=t.match(/wp-image-(\d+)/);return e?Number(e[1]):0},openImageDetails:function(t,e,i,l){const n=this,o=n.getWpImageId(t.classList.value);if(!o)return;const s={url:t.getAttribute("src")||"",alt:t.getAttribute("alt")||"",title:t.getAttribute("title")||"",width:t.getAttribute("width")||"",height:t.getAttribute("height")||"",extraClasses:n.getExtraClasses(t.classList.value)},a=n.getLinkAttributes(t,l),r=t.className.match(/align(left|right|center|none)/),c=r?r[1]:"none",d=t.className.match(/size-([^\s]+)/),u=d?d[1]:"full";wp.media.attachment(o).fetch().done((()=>{const t=wp.media({frame:"image",state:"image-details",editing:!0,multiple:!1,metadata:{attachment_id:o,url:s.url,alt:s.alt,title:s.title,caption:s.title,align:c,size:u,width:s.width,height:s.height,extraClasses:s.extraClasses,linkUrl:a.url||"",linkTarget:a.target?"_blank":"",linkRel:a.rel||"",linkClass:a.class||""}});t.$el.addClass("acf-quill-field-edit-media"),t.on("open",(function(){setTimeout((function(){try{if("_blank"===a.target){const e=t.$el.find('input[type="checkbox"][data-setting="linkTargetBlank"]');e.length&&e.prop("checked",!0).trigger("change")}if(s.extraClasses){const e=t.$el.find('input[data-setting="extraClasses"]');e.length&&e.val(s.extraClasses).trigger("change")}if(a.class){const e=['input[data-setting="linkClass"]','input[data-setting="linkClassName"]','input[name="linkClass"]',"input.link-class","input.link-class-name",'input[id*="linkclass"]','input[id*="link-class"]'];let i=null;for(const l of e){const e=t.$el.find(l);if(e.length){i=e;break}}i?(i.val(a.class).trigger("change"),console.log("Set link class to",a.class)):t.state&&t.state().props&&(t.state().props.set("linkClass",a.class),console.log("Set link class on model to",a.class))}if(a.title){const e=t.$el.find('input[data-setting="linkTitle"]');e.length&&e.val(a.title).trigger("change")}if(a.rel){const e=t.$el.find('input[data-setting="linkRel"]');e.length&&e.val(a.rel).trigger("change")}}catch(t){console.error("Error setting advanced image attributes:",t)}}),100)})),t.on("update",(n=>{console.log("Media frame update data:",n);var o=t.state().attributes.image.attachment.attributes.sizes,r=n.size?n.size:"thumbnail",c=n.width?n.width:o.thumbnail.width;c=n.customWidth?n.customWidth:c;var d=n.height?n.height:o.thumbnail.height;d=n.customheight?n.customheight:d;var u="";if(n.extraClasses)u=n.extraClasses;else if(!u){const e=t.$el.find('input[data-setting="extraClasses"]');e.length?u=e.val()||"":s.extraClasses&&(u=s.extraClasses)}const f={src:n.url,width:c,height:d,alt:n.alt||"",title:n.caption||"",class:`align${n.align||"none"} size-${r} wp-image-${n.attachment_id} ${u}`.trim()},g=(e.replaceWith("wpimage",f),!(!n.linkUrl||"none"===n.linkUrl)&&n.linkUrl);if(l.formatLine(i,1,{align:n.align||!1},"silent"),g){let e="";if(n.linkTargetBlank||"_blank"===n.linkTarget)e="_blank";else{const i=t.$el.find('input[type="checkbox"][data-setting="linkTargetBlank"]');i.length&&i.is(":checked")&&(e="_blank")}let o="";if(n.linkClass)o=n.linkClass;else if(n.linkClassName)o=n.linkClassName;else{const e=['input[data-setting="linkClass"]','input[data-setting="linkClassName"]','input[name="linkClass"]',"input.link-class","input.link-class-name",'input[id*="linkclass"]','input[id*="link-class"]'];for(const i of e){const e=t.$el.find(i);if(e.length){o=e.val()||"";break}}}!o&&a.class&&(o=a.class),console.log("Final link class value:",o);let s=n.linkRel||"";if(!s){const e=t.$el.find('input[data-setting="linkRel"]');e.length?s=e.val()||"":a.rel&&(s=a.rel)}let r=n.linkTitle||"";if(!r){const e=t.$el.find('input[data-setting="linkTitle"]');e.length?r=e.val()||"":a.title&&(r=a.title)}const c={href:g,title:r,rel:s,target:e,class:o};console.log("Applying link with data:",c),window.link&&window.link.applyLinkFormat?window.link.applyLinkFormat(l,{index:i,length:1},c):l.formatText(i,1,{link:g},"silent")}else l.formatText(i,1,{link:!1},"silent");l.setSelection(i+1,0,"silent"),l.update("user")})),t.open()}))},getExtraClasses:function(t){return t?t.split(/\s+/).filter((t=>!t.match(/^align(left|right|center|none)$/)&&!t.match(/^size-/)&&!t.match(/^wp-image-\d+$/))).join(" "):""},getLinkAttributes:function(t,e){const i={url:"",target:"",rel:"",class:""};try{const l=Quill.find(t);if(!l)return i;const n=l.offset(e.scroll);if(void 0===n)return i;const o=e.getFormat(n,1);o.link&&("string"==typeof o.link?i.url=o.link:"object"==typeof o.link&&(i.url=o.link.href||o.link,i.target=o.link.target||"",i.rel=o.link.rel||"",i.class=o.link.class||""))}catch(t){console.error("Error getting link attributes:",t)}return i}},l={init:function(){if(this.previewLink(),!Quill.__acfLinkBlotReady){const t=Quill.import("formats/link");class e extends t{static create(){let t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("string"==typeof e)t=document.createElement("a"),t.setAttribute("href",e);else{t=document.createElement("a");const i=e.href&&"object"==typeof e.href?"[object Object]"===e.href.toString()?"#":e.href.toString():e.href;t.setAttribute("href",i),e.title&&t.setAttribute("title",e.title),e.rel&&t.setAttribute("rel",e.rel),e.target&&t.setAttribute("target",e.target),e.class&&t.setAttribute("class",e.class)}return t}static formats(t){const e={href:t.getAttribute("href")};return["title","rel","target","class"].forEach((i=>{const l=t.getAttribute(i);l&&(e[i]=l)})),e}}Quill.register(e,!0),Quill.__acfLinkBlotReady=!0}document.addEventListener("acf-quill-editors-loaded",this.attachToEditors),window.acfQuillEditorsLoaded&&this.attachToEditors(),document.addEventListener("click",this.handleLinkClick)},previewLink:function(){if("undefined"==typeof jQuery)return!1;jQuery(document).on("mouseenter",".ql-editor a",(function(){let t=jQuery(this),e=t.attr("href"),i=t.attr("target")??!1;i="_blank"==i?`, ${acf_quill_field.l10n.tooltip.new_tab}`:"",jQuery(this).attr("data-balloon-pos","up"),jQuery(this).attr("aria-label",`${e}${i}`)})).on("mouseleave",".ql-editor a",(function(){jQuery(this).removeAttr("data-balloon-pos"),jQuery(this).removeAttr("aria-label")}))},handleLinkClick(t){const e=t.target.closest(".acf-quill-editor");if(!e||!e.__quill)return;const i=t.target.closest("a");if(!i)return;if("IMG"===t.target.tagName)return;t.preventDefault();const n=e.__quill,o=Quill.find(i);if(!o)return;const s=o.offset(n.scroll);if(void 0===s)return;const a=o.length();n.setSelection(s,a);const r=o.formats(),c={href:r.link?.href||r.href||"",title:r.link?.title||r.title||"",rel:r.link?.rel||r.rel||"",target:r.link?.target||r.target||"",class:r.link?.class||r.class||""};l.openDialog(c).then((t=>{null!==t&&(!1!==t&&t.href?l.applyLinkFormat(n,{index:s,length:a},t):n.format("link",!1,"user"))}))},applyLinkFormat(t,e,i){if(t.formatText(e.index,e.length,"link",!1,"silent"),t.formatText(e.index,e.length,"link",i.href,"silent"),i.title||i.rel||i.target||i.class){const t=document.querySelector('.ql-editor a[href="'+i.href+'"]');t&&(i.title&&t.setAttribute("title",i.title),i.rel&&t.setAttribute("rel",i.rel),i.target&&t.setAttribute("target",i.target),i.class&&t.setAttribute("class",i.class))}t.update("user")},attachToEditors(){document.querySelectorAll(".acf-quill-editor").forEach((t=>{if(!t.__quill)return;const e=t.__quill,i=e.getModule("toolbar");i&&(i.handlers.link=function(t){l.toolbarHandler.call(this)}),e.keyboard.addBinding({key:"K",shortKey:!0},(function(t,e){if(i)return l.toolbarHandler.call(i),!1}))}))},toolbarHandler(){const t=this.quill;if(!t)return void console.error("No quill instance in toolbar");const e=t.getSelection(!0);if(!e)return void console.warn("No selection range");const i=t.getFormat(e),n={href:i.link?.href||i.link||"",title:i.link?.title||"",rel:i.link?.rel||"",target:i.link?.target||"",class:i.link?.class||""};l.openDialog(n).then((i=>{null!==i&&(!1!==i&&i.href?(l.applyLinkFormat(t,e,i),t.setSelection(e.index+e.length,0,"silent")):t.format("link",!1,"user"))}))},openDialog:t=>new Promise((e=>{const i=document.querySelector(".acf-quill-link-modal");i&&i.remove();const l=document.createElement("div");l.className="acf-quill-link-modal";let n=acf_quill_field.link_template??"";n=n.replace("{{HREF}}",t.href),n=n.replace("{{TITLE}}",t.title),n=n.replace("{{CLASS}}",t.class),n=n.replace("{{TARGET}}","_blank"===t.target?"checked":""),n=n.replace("{{REL}}",t.rel),n=n.replace("{{NO_FOLLOW}}",t.rel?.includes("nofollow")?"checked":""),n=n.replace("{{SPONSORED}}",t.rel?.includes("sponsored")?"checked":""),l.innerHTML=n;const o=l.querySelector("form"),s=o.elements.rel,a=o.elements.rel_nofollow,r=o.elements.rel_sponsored,c=()=>{let t=s.value.split(" ").filter((t=>"nofollow"!==t&&"sponsored"!==t&&t.trim()));a.checked&&t.push("nofollow"),r.checked&&t.push("sponsored"),s.value=t.join(" ").trim()};a.addEventListener("change",c),r.addEventListener("change",c);const d=t=>{l.remove(),e(t)};l.addEventListener("click",(t=>{"cancel"===t.target.dataset.act||t.target===l?d(null):"remove"===t.target.dataset.act&&d(!1)})),o.addEventListener("submit",(t=>{t.preventDefault();const e=new FormData(o),i={href:e.get("href").trim(),title:e.get("title").trim(),class:e.get("class").trim()},l=e.get("rel").trim();l&&(i.rel=l),e.get("target")&&(i.target="_blank"),d(i)})),document.body.appendChild(l),o.elements.href.focus(),c()}))},n={init:function(){const t=this;if(0==acf_quill_field.load_custom_options)return!1;"undefined"!=typeof Quill?t.registerCustomInlineBlot():document.addEventListener("DOMContentLoaded",(()=>{"undefined"!=typeof Quill?t.registerCustomInlineBlot():console.warn("Quill not found. Custom inline formatting will not be available.")}))},registerCustomInlineBlot:function(){const t=Quill.import("blots/inline");class e extends t{static create(t){let e=super.create();if(e.setAttribute("data-value",t),window.acf_quill_field&&window.acf_quill_field.custom_options){const i=window.acf_quill_field.custom_options.find((e=>e.value===t));i&&i.class&&e.classList.add(i.class)}return e}static formats(t){return t.getAttribute("data-value")}}e.blotName="custom-inline",e.tagName="span",Quill.register(e),this.extendLoaderInitQuillEditors()},extendLoaderInitQuillEditors:function(){const e=t.initQuillEditors;t.initQuillEditors=function(){e.call(this),document.querySelectorAll(".acf-quill-editor").forEach((t=>{if("true"===t.dataset.customFormatInit)return;const e=t.__quill;if(!e)return;if(!window.acf_quill_field||!window.acf_quill_field.custom_options||0===window.acf_quill_field.custom_options.length)return;if(!e.getModule("toolbar"))return;const i=document.createElement("span");i.className="ql-formats";const l=document.createElement("select");l.className="ql-custom-inline";const n=document.createElement("option");n.value="",n.text="Format...",n.selected=!0,l.appendChild(n);const o=document.createElement("option");o.value="remove",o.text=acf_quill_field.l10n.tooltip.remove_format,l.appendChild(o),window.acf_quill_field.custom_options.forEach((t=>{const e=document.createElement("option");e.value=t.value,e.text=t.name,l.appendChild(e)})),l.addEventListener("change",(function(t){const i=t.target.value,n=e.getSelection(!0);n&&n.length>0&&(""===i||"remove"===i?e.formatText(n.index,n.length,"custom-inline",!1):e.formatText(n.index,n.length,"custom-inline",i)),setTimeout((()=>{l.value=""}),10)})),i.appendChild(l);const s=t.closest('.acf-field[data-type="quill"]').querySelector(".ql-toolbar");if(s){const t=s.querySelector(".ql-wp-media").closest(".ql-formats");t?s.insertBefore(i,t):s.appendChild(i),window.acf_quill_field&&window.acf_quill_field.l10n&&window.acf_quill_field.l10n.tooltip&&this.acfQuillFieldAddTooltip(l,acf_quill_field.l10n.tooltip.custom_format)}t.dataset.customFormatInit="true"}))}}};window.mainAcfQuillFieldPlugin={init:function(){e.init(),i.init(),window.link=l,l.init(),n.init(),t.init()}},document.addEventListener("DOMContentLoaded",(()=>{mainAcfQuillFieldPlugin.init()})),acfQuillFieldPlugin={}})();
//# sourceMappingURL=maps/main.js.map